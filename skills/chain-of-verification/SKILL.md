---
name: chain-of-verification
description: 验证链推理 (Chain of Verification). 适用于高风险、复杂或易产生幻觉的问题。通过生成独立验证问题来检查候选答案的准确性。当需要核实事实、防止虚构或提高答案置信度时使用此技能。
---

# 验证链推理技能 (Chain of Verification)

## 核心价值

此技能用于**防止幻觉**和**深度验证**。当模型对某个答案不确定，或者问题涉及重要事实（如历史事件、科学原理、人物生平）时，此技能会自动生成一组"验证问题"。

**触发建议**：
- 当你需要 "Double Check" 你的答案时。
- 当候选答案来源单一，需要交叉验证时。
- 当问题容易产生事实性错误（Hallucination）时。

## 使用场景

- 问题复杂，需要多步推理时
- 初步答案置信度中等（0.5-0.7）时
- 高价值问题（竞赛题、关键决策）需要高准确性时
- 发现初步答案可能存在逻辑漏洞时

## 核心原理

```
候选答案 → 生成验证问题 → 独立搜索验证 → 修正答案
```

传统推理可能在第一步就被误导，验证链通过主动质疑自己的答案，发现并修正错误。

## 工作流程

### 阶段1: 生成候选答案

使用常规推理流程得到初步答案：

```
问题: "谁发明了RepRap 3D打印机?"

[常规推理]
1. web_search("RepRap 3D printer inventor")
2. 找到多个候选: Adrian Bowyer, A.E. Eiben, ...
3. web_fetch(Wikipedia)

[初步答案] Adrian Bowyer

[置信度评估] 0.65 (中等)
- 原因: Wikipedia支持，但只有1个来源
```

### 阶段2: 生成验证问题

基于候选答案，生成3-5个验证问题（Output Key: `verification_queries`）：

```
候选答案: "Adrian Bowyer 发明了 RepRap 3D打印机"

[验证问题生成原则]
1. 验证答案的核心要素
2. 检查上下文一致性
3. 寻找潜在反例

[生成的验证问题] (verification_queries)
1. Adrian Bowyer 是哪个领域的专家? (验证专业背景)
2. Adrian Bowyer 在哪个机构工作? (验证身份)
3. RepRap 项目是在哪一年启动的? (验证时间线)
4. 除了 Adrian Bowyer，还有其他人声称发明了 RepRap 吗? (寻找反例)
5. Adrian Bowyer 发表过关于 RepRap 的论文吗? (验证学术贡献)
```

**验证问题类型**:

**类型A: 背景验证**
- "XXX 是什么职业?"
- "XXX 在哪里工作?"
- "XXX 的专业领域是什么?"

**类型B: 时间一致性**
- "XXX 发生在哪一年?"
- "XXX 的时间线是怎样的?"
- "XXX 在YYY之前还是之后?"

**类型C: 关系验证**
- "XXX 和 YYY 的关系是什么?"
- "XXX 是否参与了 YYY?"

**类型D: 反例搜索**
- "除了 XXX，还有谁做了 YYY?"
- "是否有其他候选答案?"

**类型E: 逻辑验证**
- "XXX 的结果是否导致了 YYY?"
- "XXX 是否符合常识?"

### 阶段3: 独立验证每个问题

```
对每个验证问题独立搜索，不受初始答案影响：

[验证问题1] "Adrian Bowyer 是哪个领域的专家?"

[搜索]
web_search("Adrian Bowyer field expertise")

[结果]
- University of Bath 官网: "mechanical engineering"
- Wikipedia: "Senior Lecturer in mechanical engineering"

[验证答案1] 机械工程专家 ✓ (与3D打印发明人身份一致)

---

[验证问题2] "Adrian Bowyer 在哪个机构工作?"

[搜索]
web_search("Adrian Bowyer university institution")

[结果]
- University of Bath官网确认

[验证答案2] University of Bath ✓

---

[验证问题3] "RepRap项目是在哪一年启动的?"

[搜索]
web_search("RepRap project founded year")

[结果]
- Wikipedia: 2005
- RepRap官网: 2005

[验证答案3] 2005年 ✓

---

[验证问题4] "除了Adrian Bowyer，还有其他人声称发明了RepRap吗?"

[搜索]
web_search("RepRap inventor NOT Bowyer")
web_search("RepRap co-founder")

[结果]
- 未发现其他主要声称者
- 提到团队成员，但 Bowyer 是创始人

[验证答案4] 无其他主要声称者 ✓

---

[验证问题5] "Adrian Bowyer发表过关于RepRap的论文吗?"

[搜索]
web_search("Adrian Bowyer RepRap paper publication")

[结果]
- 找到多篇学术论文，Bowyer是作者

[验证答案5] 有学术出版物 ✓
```

### 阶段4: 交叉验证与一致性检查

```
[汇总验证结果]

问题1 (背景): 机械工程专家 ✓
问题2 (机构): University of Bath ✓
问题3 (时间): 2005年 ✓
问题4 (反例): 无冲突 ✓
问题5 (学术): 有论文发表 ✓

[一致性检查]
✓ 机械工程背景 + 3D打印发明 → 逻辑一致
✓ University of Bath + 学术论文 → 身份可信
✓ 2005年启动 + Bowyer当时年龄~53岁 → 时间合理
✓ 无其他声称者 + 学术论文 → 答案可靠

[冲突检测]
无冲突信息

[置信度提升]
原始置信度: 0.65
验证后置信度: 0.95 (5/5验证通过)
```

### 阶段5: 修正或确认最终答案

```
[决策逻辑]

如果验证通过率 ≥ 80%:
  → 确认原答案
  → 置信度提升

如果验证通过率 50-80%:
  → 部分修正答案
  → 补充限定条件

如果验证通过率 < 50%:
  → 推翻原答案
  → 基于验证结果重新推理

[本例]
验证通过率: 100% (5/5)
决策: 确认原答案

[最终答案]
Adrian Bowyer (University of Bath 机械工程教授) 在 2005 年发明了 RepRap 3D打印机。

[置信度] 0.95 (极高)

[证据链]
1. Wikipedia确认
2. University of Bath官网确认身份
3. RepRap官网确认项目启动时间
4. 学术论文证实Bowyer的贡献
5. 无其他声称者
```

---

## 完整示例

### 示例1: 验证揭示错误

```
问题: "世界上第一个克隆哺乳动物的科学家是谁?"

[阶段1: 初步答案]
web_search("first cloned mammal scientist")
→ 结果提到 "Keith Campbell" 和 "Ian Wilmut"

[候选答案] Keith Campbell
[置信度] 0.60

[阶段2: 生成验证问题]
1. Keith Campbell 的职业是什么?
2. Keith Campbell 克隆的是哪种动物?
3. 克隆实验是在哪个机构进行的?
4. Ian Wilmut 在实验中的角色是什么? (检查是否有共同贡献者)

[阶段3: 独立验证]

验证1: "Keith Campbell职业"
→ 细胞生物学家 ✓

验证2: "Keith Campbell克隆动物"
→ Dolly the sheep (多莉羊) ✓

验证3: "克隆机构"
→ Roslin Institute ✓

验证4: "Ian Wilmut角色"
→ ⚠️ Wikipedia: "Ian Wilmut led the research team"
→ ⚠️ 多个来源: "Wilmut和Campbell共同领导"

[阶段4: 发现冲突]
⚠️ Ian Wilmut 也是主要贡献者
⚠️ 团队合作，非单一发明人

[阶段5: 修正答案]
❌ 原答案: "Keith Campbell"
✓ 修正答案: "Ian Wilmut 和 Keith Campbell 共同领导团队克隆了多莉羊"

[置信度] 0.90 (修正后)
```

---

### 示例2: 验证确认复杂答案

```
问题: "2023年诺贝尔物理学奖得主的主要贡献是什么?"

[阶段1: 初步答案]
multi_strategy_search(strategy="news")
→ 找到 "attosecond pulses of light"

[候选答案] 阿秒光脉冲技术

[置信度] 0.70

[阶段2: 生成验证问题]
1. 什么是阿秒? (验证概念理解)
2. 阿秒光脉冲有什么应用? (验证贡献的重要性)
3. 三位得主分别是谁? (验证完整性)
4. 这项技术是什么时候发展出来的? (验证时间线)
5. 阿秒光脉冲与电子动力学研究的关系? (验证深层原理)

[阶段3: 独立验证]

验证1: "什么是阿秒"
→ 1阿秒 = 10^-18秒 ✓
→ 极短时间尺度 ✓

验证2: "阿秒光脉冲应用"
→ 研究电子运动 ✓
→ 化学反应动力学 ✓

验证3: "三位得主"
→ Pierre Agostini ✓
→ Ferenc Krausz ✓
→ Anne L'Huillier ✓

验证4: "技术发展时间"
→ 1980s-2000s逐步发展 ✓
→ 2001年首次产生阿秒脉冲 ✓

验证5: "与电子动力学关系"
→ 阿秒时间尺度 = 电子运动时间尺度 ✓
→ 可以"拍摄"电子运动 ✓

[阶段4: 一致性检查]
✓ 所有验证通过
✓ 概念理解正确
✓ 应用场景明确
✓ 时间线合理

[阶段5: 增强答案]
原答案: "阿秒光脉冲技术"

✓ 增强答案:
"产生阿秒光脉冲的实验方法，用于研究物质中电子动力学。
阿秒(10^-18秒)是电子运动的时间尺度，这项技术首次让人类能够
观察和测量电子的运动过程。"

[置信度] 0.95 (从0.70提升)
```

---

## 验证问题生成模板

根据不同问题类型，使用不同模板：

### 人物类问题

```
原问题: "谁发明/发现/创造了XXX?"
候选答案: 人名

验证问题模板:
1. [人名] 的职业/专业领域是什么?
2. [人名] 在哪个机构/公司工作?
3. [人名] 是在哪一年做出这个贡献的?
4. 除了[人名]，还有其他贡献者吗?
5. [人名] 有相关的学术出版物吗?
```

### 时间类问题

```
原问题: "XXX是在哪一年发生的?"
候选答案: 年份

验证问题模板:
1. XXX的完整时间线是怎样的?
2. XXX之前发生了什么相关事件?
3. XXX之后产生了什么影响?
4. 不同来源对XXX的时间记录是否一致?
5. XXX的时间是否与相关人物的生平一致?
```

### 概念类问题

```
原问题: "什么是XXX?"
候选答案: 定义

验证问题模板:
1. XXX的核心原理/机制是什么?
2. XXX有哪些实际应用?
3. XXX是由谁提出/发明的?
4. XXX与相关概念YYY的区别是什么?
5. 权威来源(教科书/官方文档)如何定义XXX?
```

### 因果类问题

```
原问题: "XXX对YYY有什么影响?"
候选答案: 影响描述

验证问题模板:
1. XXX发生的时间是否早于YYY?
2. 是否有直接证据表明XXX导致了YYY?
3. 除了XXX，还有其他因素影响YYY吗?
4. YYY的变化是否与XXX的程度相关?
5. 权威研究如何评价XXX对YYY的影响?
```

---

## 高级技巧

### 技巧1: 逐层验证

```
对于复杂答案，分层验证：

答案: "Adrian Bowyer在2005年发明了RepRap"

第一层: 验证核心事实
- Adrian Bowyer是发明人吗? ✓
- 时间是2005年吗? ✓

第二层: 验证上下文
- Bowyer的专业背景支持这个发明吗? ✓
- 2005年的技术条件允许这个发明吗? ✓

第三层: 验证影响
- RepRap之后产生了预期的影响吗? ✓
- Bowyer因此获得了相应的认可吗? ✓

所有层次验证通过 → 答案高度可靠
```

### 技巧2: 对抗性验证

```
主动寻找能推翻答案的证据：

候选答案: "XXX是YYY"

对抗性验证问题:
1. 是否有来源说"XXX不是YYY"?
2. 是否有其他候选答案ZZZ比YYY更可信?
3. YYY是否存在逻辑矛盾?

如果找到反例 → 深入调查
如果找不到反例 → 增强信心
```

### 技巧3: 时间一致性检查

```
验证事件时间的逻辑性：

答案: "Adrian Bowyer在2005年发明了RepRap"

时间验证:
1. Bowyer的出生年份 (1952)
2. 2005年Bowyer年龄: 53岁 ✓ (合理的创造力巅峰期)
3. 相关技术(3D打印)的发展阶段: 2000s早期正是快速发展期 ✓
4. RepRap之后的发展: 2006-2008大量衍生项目 ✓ (时间线连贯)

所有时间节点逻辑一致 → 增强可信度
```

### 技巧4: 数量级检查

```
对于数字答案，验证数量级合理性：

答案: "人类基因组计划花费了27亿美元"

数量级验证:
1. 项目规模: 测序30亿碱基对 → 巨大
2. 项目时长: 1990-2003 (13年) → 长期
3. 参与机构: 多国合作 → 大规模
4. 同期类似项目预算: 国际空间站~1000亿美元

27亿美元 ≈ 每年2亿美元 → 合理 ✓
(不是2700万 太少 ×, 也不是2700亿 太多 ×)
```

---

## 验证失败处理

### 场景1: 大部分验证失败

```
验证通过率: 20% (1/5)

[分析]
- 4个验证问题得到与候选答案矛盾的信息
- 唯一支持的验证来源可信度低

[决策]
❌ 推翻原答案
✓ 基于验证结果重新构建答案

[行动]
1. 分析哪些验证问题的答案是一致的
2. 以这些一致的信息为基础重新推理
3. 生成新的候选答案
4. 对新答案再次运行验证链
```

### 场景2: 验证结果相互矛盾

```
验证问题1: 来源A说 "2004年"
验证问题1: 来源B说 "2005年"

[处理]
1. 评估来源可信度
   - 来源A: 博客 (0.4)
   - 来源B: 官方网站 (0.85)

2. 寻找第三方仲裁
   - 搜索更多来源
   - 优先权威来源

3. 统计多数
   - 如果3个来源支持"2005"，1个支持"2004"
   - 采用多数意见

4. 时间线交叉验证
   - 检查其他事件的时间是否支持某个答案
```

### 场景3: 验证问题无法回答

```
验证问题: "XXX的具体机制是什么?"
搜索结果: 无法找到详细信息

[处理]
1. 简化验证问题
   "XXX的机制" → "XXX的基本原理"

2. 改变验证角度
   如果无法验证机制，验证效果
   "XXX如何工作" → "XXX产生了什么结果"

3. 标记为部分验证
   无法完全验证，但不影响核心答案

4. 在最终答案中注明
   "具体机制尚不明确，但效果已被证实"
```

---

## 检查清单

开始验证链前:

- [ ] 已有候选答案
- [ ] 候选答案置信度 < 0.85 (否则可能不需要验证链)
- [ ] 问题足够重要，值得花费额外步骤验证

生成验证问题时:

- [ ] 生成3-5个验证问题
- [ ] 涵盖不同验证维度 (背景/时间/关系/反例)
- [ ] 验证问题彼此独立
- [ ] 验证问题可以通过搜索回答

验证完成后:

- [ ] 至少3个验证问题得到回答
- [ ] 记录了每个验证的来源
- [ ] 检查了验证结果的一致性
- [ ] 计算了最终置信度

---

## 输出格式

```
### 验证链推理结果

**原始问题**: [用户问题]

**候选答案**: [初步答案] (置信度: 0.XX)

**验证问题与结果**:

1. [验证问题1]
   验证答案: [答案]
   来源: [URL]
   状态: ✓ 支持 / ⚠️ 部分支持 / ✗ 矛盾

2. [验证问题2]
   ...

**一致性检查**:
- 验证通过率: XX%
- 冲突信息: [有/无]
- 时间线一致性: [一致/不一致]

**最终答案**: [修正后的答案]

**置信度**: 0.XX → 0.XX (提升/降低)

**决策依据**:
[简要说明为何确认/修正/推翻原答案]
```

---

## 与其他技能配合

```
标准工作流:

1. smart-search
   → 找到初步信息

2. multi-source-verify
   → 基础验证 (多源一致性)

3. chain-of-verification (本技能)
   → 深度验证 (主动质疑)

4. 输出最终答案
   → 高置信度答案
```

---

## 记住

> **质疑自己，才能接近真相**
>
> 不要满足于第一个看似合理的答案。
> 通过验证链主动寻找可能的错误，
> 即使增加了推理步骤，也能大幅提升准确性。
>
> 验证通过 → 信心倍增
> 验证失败 → 及时修正
